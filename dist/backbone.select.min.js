// Backbone.Select, v1.1.0
// Copyright (c) 2014 Michael Heim
//           (c) 2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/hashchange/backbone.select


Backbone.Select=function(Backbone,_){function a(a,b){f(a,b),a.selected&&b.select(a,{_silentReselect:!0,_externalEvent:"add"})}function b(a,b,d){c(a,b,_.extend({},d,{_externalEvent:"remove"}))}function c(a,b,c){a._pickyCollections&&(a._pickyCollections=_.without(a._pickyCollections,b._pickyCid)),a.selected&&(a._pickyCollections&&0===a._pickyCollections.length?b.deselect(a,c):b.deselect(a,_.extend({},c,{_skipModelCall:!0})))}function d(a,b){var d,e,f=_.find(b.previousModels,function(a){return a.selected});f&&c(f,a,{_silentLocally:!0}),d=a.filter(function(a){return a.selected}),e=_.initial(d),e.length&&_.each(e,function(a){a.deselect()}),d.length&&a.select(_.last(d),{silent:!0})}function e(a,b){var d,e=_.filter(b.previousModels,function(a){return a.selected});e&&_.each(e,function(b){c(b,a,{_silentLocally:!0})}),d=a.filter(function(a){return a.selected}),d.length&&_.each(d,function(b){a.select(b,{silent:!0})})}function f(a,b){a._pickyCollections||(a._pickyCollections=[]),a._pickyCollections.push(b._pickyCid)}function g(a){a.each(function(b){c(b,a,{_silentLocally:!0})})}function h(a){return _.omit(a,"_silentLocally","_externalEvent")}function i(a){return _.omit(a,"_silentLocally","_silentReselect","_skipModelCall","_processedBy")}function j(a){function b(a,b){c[b]=a}var c=[];return _.each(a,b),c}function k(a){function b(a,b,c){return c.toUpperCase()}function c(a){return"ed"===a.slice(-2)?a=a.slice(0,-2):(":one"===a.slice(-4)||":any"===a.slice(-4))&&(a=a.slice(0,-4)),a}var d=a.trigger,e=/(^|:)(\w)/gi;return function(a){var f=c(a),g="on"+f.replace(e,b),h=this[g];return _.isFunction(h)&&h.apply(this,_.tail(arguments)),d.apply(this,arguments),this}}var l={};l.One=function(){},_.extend(l.One.prototype,{_pickyType:"Backbone.Select.One",select:function(a,b){var c=a&&this.selected===a?a:void 0;b||(b={}),b._processedBy||(b._processedBy=[]),b._processedBy[this._pickyCid]||(c||(this.deselect(void 0,_.omit(b,"_silentLocally")),this.selected=a),b._processedBy[this._pickyCid]=this,b._processedBy[this.selected.cid]||this.selected.select(h(b)),b.silent||b._silentLocally||(c?b._silentReselect||this.trigger("reselect:one",a,this,i(b)):this.trigger("select:one",a,this,i(b))))},deselect:function(a,b){b||(b={}),this.selected&&(a=a||this.selected,this.selected===a&&(delete this.selected,b._skipModelCall||a.deselect(h(b)),b.silent||b._silentLocally||this.trigger("deselect:one",a,this,i(b))))},close:function(){g(this),this.stopListening()}}),l.Many=function(){},_.extend(l.Many.prototype,{_pickyType:"Backbone.Select.Many",select:function(a,b){var c=j(this.selected),d=this.selected[a.cid]?[a]:[];b||(b={}),b._processedBy||(b._processedBy=[]),d.length&&b._processedBy[this._pickyCid]||(d.length||(this.selected[a.cid]=a,this.selectedLength=_.size(this.selected)),b._processedBy[this._pickyCid]=this,b._processedBy[a.cid]||a.select(h(b)),m(this,c,b,d))},deselect:function(a,b){var c=j(this.selected);b||(b={}),this.selected[a.cid]&&(delete this.selected[a.cid],this.selectedLength=_.size(this.selected),b._skipModelCall||a.deselect(h(b)),m(this,c,b))},selectAll:function(a){var b=j(this.selected),c=[];a||(a={}),a._processedBy||(a._processedBy=[]),this.selectedLength=0,this.each(function(b){this.selectedLength++,this.selected[b.cid]&&c.push(b),this.select(b,_.extend({},a,{_silentLocally:!0}))},this),a._processedBy[this._pickyCid]=this,m(this,b,a,c)},deselectAll:function(a){var b;0!==this.selectedLength&&(b=j(this.selected),this.each(function(b){b.selected&&this.selectedLength--,this.deselect(b,_.extend({},a,{_silentLocally:!0}))},this),this.selectedLength=0,m(this,b,a))},selectNone:function(a){this.deselectAll(a)},toggleSelectAll:function(a){this.selectedLength===this.length?this.deselectAll(a):this.selectAll(a)},close:function(){g(this),this.stopListening()}}),l.Me=function(){},_.extend(l.Me.prototype,{_pickyType:"Backbone.Select.Me",select:function(a){var b=this.selected;a||(a={}),a._processedBy||(a._processedBy=[]),a._processedBy[this.cid]||(this.selected=!0,a._processedBy[this.cid]=this,this._pickyCollections?this.trigger("_selected",this,h(a)):this.collection&&(a._processedBy[this.collection._pickyCid]||this.collection.select(this,h(a))),a.silent||a._silentLocally||(b?a._silentReselect||this.trigger("reselected",this,i(a)):this.trigger("selected",this,i(a))))},deselect:function(a){a||(a={}),this.selected&&(this.selected=!1,this._pickyCollections?this.trigger("_deselected",this,h(a)):this.collection&&this.collection.deselect(this,h(a)),a.silent||a._silentLocally||this.trigger("deselected",this,i(a)))},toggleSelected:function(a){this.selected?this.deselect(a):this.select(a)}}),l.Me.applyTo=function(a){_.extend(a,new Backbone.Select.Me),a.trigger=k(a)},l.One.applyTo=function(c,e,g){_.extend(c,new Backbone.Select.One),c._pickyCid=_.uniqueId("singleSelect"),c.trigger=k(c),g&&g.enableModelSharing&&(_.each(e||[],function(a){f(a,c),a.selected&&(c.selected&&c.selected.deselect(),c.selected=a)}),c.listenTo(c,"_selected",c.select),c.listenTo(c,"_deselected",c.deselect),c.listenTo(c,"reset",d),c.listenTo(c,"add",a),c.listenTo(c,"remove",b),c._modelSharingEnabled=!0)},l.Many.applyTo=function(c,d,g){_.extend(c,new Backbone.Select.Many),c._pickyCid=_.uniqueId("multiSelect"),c.selected={},c.trigger=k(c),g&&g.enableModelSharing&&(_.each(d||[],function(a){f(a,c),a.selected&&(c.selected[a.cid]=a)}),c.listenTo(c,"_selected",c.select),c.listenTo(c,"_deselected",c.deselect),c.listenTo(c,"reset",e),c.listenTo(c,"add",a),c.listenTo(c,"remove",b),c._modelSharingEnabled=!0)};var m=function(a,b,c,d){function e(a,b,c){function d(a){return b.get(a)||c[a]}return _.map(a,d)}if(c||(c={}),!c.silent&&!c._silentLocally){var f,g=a.selectedLength,h=a.length,j=_.keys(b),k=_.keys(a.selected),l=_.difference(k,j),m=_.difference(j,k),n=g===j.length&&0===l.length&&0===m.length;if(d&&d.length&&!c._silentReselect&&a.trigger("reselect:any",d,a,i(c)),!n)return f={selected:e(l,a,b),deselected:e(m,a,b)},g===h?void a.trigger("select:all",f,a,i(c)):0===g?void a.trigger("select:none",f,a,i(c)):g>0&&h>g?void a.trigger("select:some",f,a,i(c)):void 0}};return l}(Backbone,_);
//# sourceMappingURL=backbone.select.min.map