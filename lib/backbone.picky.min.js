// Backbone.Picky, v0.2.0
// Copyright (c)2014 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/derickbailey/backbone.picky


Backbone.Picky=function(a,b){function c(a,b){h(a,b),a.selected&&b.select(a,{_silentReselect:!0,_externalEvent:"add"})}function d(a,c,d){e(a,c,b.extend({},d,{_externalEvent:"remove"}))}function e(a,c,d){a._pickyCollections&&(a._pickyCollections=b.without(a._pickyCollections,c._pickyCid)),a.selected&&(a._pickyCollections&&0===a._pickyCollections.length?c.deselect(a,d):c.deselect(a,b.extend({},d,{_skipModelCall:!0})))}function f(a,c){var d,f,g=b.find(c.previousModels,function(a){return a.selected});g&&e(g,a,{_silentLocally:!0}),d=a.filter(function(a){return a.selected}),f=b.initial(d),f.length&&b.each(f,function(a){a.deselect()}),d.length&&a.select(b.last(d),{silent:!0})}function g(a,c){var d,f=b.filter(c.previousModels,function(a){return a.selected});f&&b.each(f,function(b){e(b,a,{_silentLocally:!0})}),d=a.filter(function(a){return a.selected}),d.length&&b.each(d,function(b){a.select(b,{silent:!0})})}function h(a,b){a._pickyCollections||(a._pickyCollections=[]),a._pickyCollections.push(b._pickyCid)}function i(a){a.each(function(b){e(b,a,{_silentLocally:!0})})}function j(a){return b.omit(a,"_silentLocally","_externalEvent")}function k(a){return b.omit(a,"_silentLocally","_silentReselect","_skipModelCall","_processedBy")}function l(a){function c(a,b){d[b]=a}var d=[];return b.each(a,c),d}function m(a){function c(a,b,c){return c.toUpperCase()}function d(a){return"ed"===a.slice(-2)?a=a.slice(0,-2):(":one"===a.slice(-4)||":any"===a.slice(-4))&&(a=a.slice(0,-4)),a}var e=a.trigger,f=/(^|:)(\w)/gi;return function(a){var g=d(a),h="on"+g.replace(f,c),i=this[h];return b.isFunction(i)&&i.apply(this,b.tail(arguments)),e.apply(this,arguments),this}}var n={};n.SingleSelect=function(a,e){this._pickyCid=b.uniqueId("singleSelect"),this.collection=a,this.trigger=m(a),arguments.length>1&&(b.each(e||[],function(a){h(a,this),a.selected&&(this.selected&&this.selected.deselect(),this.selected=a)},this),this.collection.listenTo(this.collection,"_selected",this.select),this.collection.listenTo(this.collection,"_deselected",this.deselect),this.collection.listenTo(this.collection,"reset",f),this.collection.listenTo(this.collection,"add",c),this.collection.listenTo(this.collection,"remove",d),this._modelSharingEnabled=!0)},b.extend(n.SingleSelect.prototype,{select:function(a,c){var d=a&&this.selected===a?a:void 0;c||(c={}),c._processedBy||(c._processedBy=[]),c._processedBy[this._pickyCid]||(d||(this.deselect(void 0,b.omit(c,"_silentLocally")),this.selected=a),c._processedBy[this._pickyCid]=this,c._processedBy[this.selected.cid]||this.selected.select(j(c)),c.silent||c._silentLocally||(d?c._silentReselect||this.trigger("reselect:one",a,this,k(c)):this.trigger("select:one",a,this,k(c))))},deselect:function(a,b){b||(b={}),this.selected&&(a=a||this.selected,this.selected===a&&(delete this.selected,b._skipModelCall||a.deselect(j(b)),b.silent||b._silentLocally||this.trigger("deselect:one",a,this,k(b))))},close:function(){i(this),this.stopListening()}}),n.MultiSelect=function(a,e){this._pickyCid=b.uniqueId("multiSelect"),this.collection=a,this.selected={},this.trigger=m(a),arguments.length>1&&(b.each(e||[],function(a){h(a,this),a.selected&&(this.selected[a.cid]=a)},this),this.collection.listenTo(this.collection,"_selected",this.select),this.collection.listenTo(this.collection,"_deselected",this.deselect),this.collection.listenTo(this.collection,"reset",g),this.collection.listenTo(this.collection,"add",c),this.collection.listenTo(this.collection,"remove",d),this._modelSharingEnabled=!0)},b.extend(n.MultiSelect.prototype,{select:function(a,c){var d=l(this.selected),e=this.selected[a.cid]?[a]:[];c||(c={}),c._processedBy||(c._processedBy=[]),e.length&&c._processedBy[this._pickyCid]||(e.length||(this.selected[a.cid]=a,this.selectedLength=b.size(this.selected)),c._processedBy[this._pickyCid]=this,c._processedBy[a.cid]||a.select(j(c)),o(this,d,c,e))},deselect:function(a,c){var d=l(this.selected);c||(c={}),this.selected[a.cid]&&(delete this.selected[a.cid],this.selectedLength=b.size(this.selected),c._skipModelCall||a.deselect(j(c)),o(this,d,c))},selectAll:function(a){var c=l(this.selected),d=[];a||(a={}),a._processedBy||(a._processedBy=[]),this.selectedLength=0,this.each(function(c){this.selectedLength++,this.selected[c.cid]&&d.push(c),this.select(c,b.extend({},a,{_silentLocally:!0}))},this),a._processedBy[this._pickyCid]=this,o(this,c,a,d)},deselectAll:function(a){var c;0!==this.selectedLength&&(c=l(this.selected),this.each(function(c){c.selected&&this.selectedLength--,this.deselect(c,b.extend({},a,{_silentLocally:!0}))},this),this.selectedLength=0,o(this,c,a))},selectNone:function(a){this.deselectAll(a)},toggleSelectAll:function(a){this.selectedLength===this.length?this.deselectAll(a):this.selectAll(a)},close:function(){i(this),this.stopListening()}}),n.Selectable=function(a){this.model=a,this.trigger=m(a)},b.extend(n.Selectable.prototype,{select:function(a){var b=this.selected;a||(a={}),a._processedBy||(a._processedBy=[]),a._processedBy[this.cid]||(this.selected=!0,a._processedBy[this.cid]=this,this._pickyCollections?this.trigger("_selected",this,j(a)):this.collection&&(a._processedBy[this.collection._pickyCid]||this.collection.select(this,j(a))),a.silent||a._silentLocally||(b?a._silentReselect||this.trigger("reselected",this,k(a)):this.trigger("selected",this,k(a))))},deselect:function(a){a||(a={}),this.selected&&(this.selected=!1,this._pickyCollections?this.trigger("_deselected",this,j(a)):this.collection&&this.collection.deselect(this,j(a)),a.silent||a._silentLocally||this.trigger("deselected",this,k(a)))},toggleSelected:function(a){this.selected?this.deselect(a):this.select(a)}}),n.Selectable.applyTo=function(c){b.extend(c,new a.Picky.Selectable(c))},n.SingleSelect.applyTo=function(c,d){var e;e=arguments.length<2?new a.Picky.SingleSelect(c):new a.Picky.SingleSelect(c,d),b.extend(c,e)},n.MultiSelect.applyTo=function(c,d){var e;e=arguments.length<2?new a.Picky.MultiSelect(c):new a.Picky.MultiSelect(c,d),b.extend(c,e)};var o=function(a,c,d,e){function f(a,c,d){function e(a){return c.get(a)||d[a]}return b.map(a,e)}if(d||(d={}),!d.silent&&!d._silentLocally){var g,h=a.selectedLength,i=a.length,j=b.keys(c),l=b.keys(a.selected),m=b.difference(l,j),n=b.difference(j,l),o=h===j.length&&0===m.length&&0===n.length;if(e&&e.length&&!d._silentReselect&&a.trigger("reselect:any",e,a,k(d)),!o)return g={selected:f(m,a,c),deselected:f(n,a,c)},h===i?void a.trigger("select:all",g,a,k(d)):0===h?void a.trigger("select:none",g,a,k(d)):h>0&&i>h?void a.trigger("select:some",g,a,k(d)):void 0}};return n}(Backbone,_);
//# sourceMappingURL=backbone.picky.map